- name: build go
  shell: CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo  -o ../docker/echoserver ../echoserver.go

- name: Build image
  docker_image:
    path: ../docker/
    name: echoserver:latest

- name: start a container
  docker_container:
      name: echoserver_container
      image: echoserver:latest
      state: started                       
      ports:
        - "8090:8090"

          # name: run UAT locally
          # shell:  go test
          # args:
          #   chdir: ../uat/
- name: get  docker  aws login
  shell: aws ecr get-login --region {{ awsregion }}
  register: login

- name: get  docker  aws login
  shell: "{{ login.stdout }}"
  register: login
- name: print login
  debug: var=login
- name: get repository
  shell: aws ecr describe-repositories
  register: repos

- name: show repos
  debug:  var=repos


- name: create repo
  shell:  aws ecr create-repository --repository-name echoserver

- name: tag image 
  shell: docker tag echoserver:latest 042967111928.dkr.ecr.{{ awsregion }}.amazonaws.com/echoserver:latest
- name: push image 
  shell: docker push 042967111928.dkr.ecr.{{ awsregion }}.amazonaws.com/echoserver:latest 
